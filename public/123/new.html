<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="./css/new.css">
        <script src="./js/tweenMax.min.js"></script>
        <script src="./js/jquery.js"></script>
    </head>
    <body>
      <div style="text-align: center;margin-bottom: 10px;">
        <span style="margin:0 auto;padding:50">
          <span class="neon">
            Great Gatsby 
          </span>
          <span class="neon2">
            &
          </span>
          <span class="flux">
            the Pilot
          </span>
        </span>
      </div>
      <table class="table">
        <tr class='title-tr'>
          <td><span class="time">Time</span></td>
          <td></td>
          <td><span class="stage">Tonight on Stage</span></td>
          <td></td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h0' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m0' class="num2">
                <div class="upper"></div> 
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="blank" rowspan=9>
            <span id="indicater">
              <img id="airplan" src="./public/explan.png">
            </span>
          </td>
          <td>
            <span class="clock">
              <div id="s0" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td rowspan=9>
            <span class="neon-wrapper">
              <span class="clock3">
                <div id="img1" class="num3">
                  <div class="upper3"></div>
                  <div class="base3 upper3"></div>
                  <div class="base3 lower3"></div>
                  <div class="lower3"></div>
                </div>
              </span>
            </span>
          </td>
        </tr>
       
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h1' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m1' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s1" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h2' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m2' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s2" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h3' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m3' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s3" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h4' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m4' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s4" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h5' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m5' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s5" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div >
            </span>
          </td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h6' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m6' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s6" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div >
            </span>
          </td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h7' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m7' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s7" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div >
            </span>
          </td>
        </tr>
        <tr>
          <td class='short-td'>
            <span class="clock2">
              <div id='h8' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
            <span class="colon">:</span>
            <span class="clock2">
              <div id='m8' class="num2">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div>
            </span>
          </td>
          <td class="long-td">
            <span class="clock">
              <div id="s8" class="num">
                <div class="upper"></div>
                <div class="base upper"></div>
                <div class="base lower"></div>
                <div class="lower"></div>
              </div >
            </span>
          </td>
        </tr>
      </table>
        <script>
            // set 3d transforms
TweenMax.set("#clock", {perspective:1500, scale:0.7125})
TweenMax.set(".upper", {rotationX:0.01, transformOrigin:"50% 100%"})
TweenMax.set(".lower", {rotationX:0.01, transformOrigin:"50% 0%"})

var isKorean = true;

var getValue = localStorage.getItem('data');
var stageData = JSON.parse(getValue);
console.log(stageData);
var textArray = stageData.textArray;
var imageArray = stageData.images.split(',');
setHtml(s0,textArray[0].korean);
setHtml(s1,textArray[1].korean);
setHtml(s2,textArray[2].korean);
setHtml(s3,textArray[3].korean);
setHtml(s4,textArray[4].korean);
setHtml(s5,textArray[5].korean);
setHtml(s6,textArray[6].korean);
setHtml(s7,textArray[7].korean);
setHtml(s8,textArray[8].korean);

setHtml(h0,textArray[0].hour);
setHtml(h1,textArray[1].hour);
setHtml(h2,textArray[2].hour);
setHtml(h3,textArray[3].hour);
setHtml(h4,textArray[4].hour);
setHtml(h5,textArray[5].hour);
setHtml(h6,textArray[6].hour);
setHtml(h7,textArray[7].hour);
setHtml(h8,textArray[8].hour);

setHtml(m0,textArray[0].minute);
setHtml(m1,textArray[1].minute);
setHtml(m2,textArray[2].minute);
setHtml(m3,textArray[3].minute);
setHtml(m4,textArray[4].minute);
setHtml(m5,textArray[5].minute);
setHtml(m6,textArray[6].minute);
setHtml(m7,textArray[7].minute);
setHtml(m8,textArray[8].minute);

var stringF = [];
var stringE = [];

var i = 0;
for(var text of textArray){
  stringF[i] = text.korean;
  stringE[i] = text.english;
  i++;
}
function setRotate(array){
  var i =0;
  for(var obj of array){
    if(isKorean){
      stringF[i] = obj.korean;
      stringE[i] = obj.english;
    } else {
      stringF[i] = obj.english;
      stringE[i] = obj.korean;
    }
    i++;
    
  }
  isKorean = isKorean === false ? true : false;
}
// set 3d transforms
TweenMax.set("#clock3", {perspective:1500, scale:0.7125})
TweenMax.set(".upper3", {rotationX:0.01, transformOrigin:"50% 100%"})
TweenMax.set(".lower3", {rotationX:0.01, transformOrigin:"50% 0%"})

img1.childNodes[3].innerHTML = img1.childNodes[7].innerHTML = "<span>"+"<img class='image3' src='images/"+imageArray[0]+"' />"+"</span>";

var startImg = '';
var endImg = '';

// start ticking
var trigger = 0;

var interval = setInterval(function(){

setRotate(textArray);

tick(s0,stringF[0],stringE[0],0);
tick(s1,stringF[1],stringE[1],500);
tick(s2,stringF[2],stringE[2],1000);
tick(s3,stringF[3],stringE[3],1500);
tick(s4,stringF[4],stringE[4],2000);
tick(s5,stringF[5],stringE[5],2500);
tick(s6,stringF[6],stringE[6],3000);
tick(s7,stringF[7],stringE[7],3500);
tick(s8,stringF[8],stringE[8],4000);

}, 7000);

var interval2 = setInterval(function(){
  setRotateImage();
  tick(img1,startImg,endImg,0);

}, 5000);

checkNow();

var interval3 = setInterval(() => {
  checkNow();
}, 60000);


var timeout = setTimeout(function(){
  window.location.reload();
},36000000);


function setHtml(node,value){
  node.childNodes[3].innerHTML = node.childNodes[7].innerHTML = "<span>"+value+"</span>";

}
function checkNow(){
  var d = new Date();
  var hour = 16;//d.getHours();
  var min = 55;//d.getMinutes()-1;
  var index = 0;
  airplan.style.display = 'none';

  here : for(time of textArray){
    var startH = parseInt(time.hour);
    var startM = parseInt(time.minute);
    var endH = parseInt(time.eHour);
    var endM = parseInt(time.eMinute);

    if(hour == 24){
      hour = 0;
    }
    if(startH == 24){
      startH = 0;
    }
    if(endH == 24){
      endH = 0;
    }
    if(hour < 12){
      hour += 24;
    }
    if(startH < 12){
      startH += 24;
    }
    if(endH < 12){
      endH += 24;
    }

    // 시작 시간 기준 같고 분단위가 넘거나 같은경우
    if( hour > startH || (hour == startH && min >= startM)){
      // 마감시간이 넘으면 continue
      if(hour > endH || (hour == endH && min > endM)){
        setPlaneStop(index);
      } else{
        setNowStage(index);
        break;
      }
    }
    index++;
  }
}
function setPlaneStop(index){
  airplan.style.display = 'inline-block';
  let height2 = index*74 - 295 + 37;
  airplan.style.top = height2;

}
function setNowStage(index){
  let j = index != 0 ? index : 0;
  let x = j !=0 ? j-1 : 1;
  let hour = document.getElementById(textArray[j].hId);
  let min = document.getElementById(textArray[j].mId);
  let stage = document.getElementById(textArray[j].sId);
  let exHour = document.getElementById(textArray[x].hId);
  let exMin = document.getElementById(textArray[x].mId);
  let exStage = document.getElementById(textArray[x].sId);
  let height = j*74 - 295;
  hour.style.color = "green";
  min.style.color = "green";
  stage.style.color = "green";
  exHour.style.color = "white";
  exMin.style.color = "white";
  exStage.style.color = "white";
  $(stage).children('div').children('span').attr('class','neon3');
  airplan.style.display = 'inline-block';
  airplan.style.top = height;
}
function setRotateImage(){

startImg = "<img class='image3' src='images/"+imageArray[trigger]+"' />";
if(trigger+1 == imageArray.length){
  trigger = -1;
}
endImg = "<img class='image3' src='images/"+imageArray[trigger+1]+"' />";

trigger++;
}
function tick(mc,stringF,stringE,delay){
    // set numbers
  setTimeout(function(){
    mc.childNodes[3].innerHTML = "<span>"+stringF+"</span>"; //start upper
    mc.childNodes[5].innerHTML = "<span>"+stringF+"</span>"; //start lower
    mc.childNodes[1].innerHTML = "<span>"+stringE+"</span>"; //end upper
    mc.childNodes[7].innerHTML = "<span>"+stringE+"</span>"; //end lower
    // animate tick
    TweenMax.fromTo(mc.childNodes[1], .3, {alpha:0},{alpha:1, ease:Power4.easeIn})  
    TweenMax.fromTo(mc.childNodes[3], .3, {rotationX:0, background:"linear-gradient(0deg, #000000,#0000000 15%)"},{rotationX:-90, ease:Power1.easeIn})
    TweenMax.fromTo(mc.childNodes[7], .5+.2*Math.random(), {rotationX:90},{rotationX:0, ease:Bounce.easeOut, delay:.3})
    TweenMax.fromTo(mc.childNodes[5], .6, {alpha:1},{alpha:0, ease:Bounce.easeOut, delay:.3})  
  },delay);
}

        </script>
    </body>
</html>
