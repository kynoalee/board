<html>
    <head>
        <meta charset='utf-8'>
        <script src="./jquery.js"></script>
        <style>
            body {
                margin : 20px;
            }
        </style>
    </head>
    <body>
        <h1 id ="test">무대 내용 입력</h1>
        <div id='stageData'>
            <select name="hour">
                <option value=""></option>
            </select>
            <select name="minute">
                <option value=""></option>
            </select>

            <input type="text" name='korean' />
            <input type="text" name='english' />
        </div>
        <div>
            <button type="button" onclick='setJson()'>변경</button>
        </div>
        <script>
            setHtml();
            setData();

            function setHtml(){
                var div = document.getElementById('stageData');
                var html = '';
                for(var i=0; i<8; i++){
                    var d = new Date();
                    var nowH = d.getHours();
                    var nowM = d.getMinutes();
                    html += '<div>';
                    html += '<div><h4>'+(i+1)+'번째 무대</h4></div>';
                    html += '<select id="hour'+i+'">';
                    for(var j=0;j<=24;j++){
                        html+= '<option value="'+numFormat(j)+'">'+numFormat(j)+'</option>';
                    }
                    html += '</select>';
                    html += ' : ';
                    html += '<select id="minute'+i+'">';
                    
                    for(var x=0;x<60;x+=5){
                        html+= '<option value="'+numFormat(x)+'">'+numFormat(x)+'</option>';
                    }
                    html += '</select>';

                    html += '<span>한글명</span> <input name="korean'+i+'" / > ';
                    html += '<span>영어명</span> <input name="english'+i+'" / > ';
                    html += '</div>';
                }
                div.innerHTML=html;
            }

            function setData(){
                var jsonString = localStorage.getItem('data');
                var json = JSON.parse(jsonString);
                var jsonData = json.textArray;
                var index = 0;
                for(var val of jsonData){
                    $('#hour'+index).val(val.hour).prop('selected',true);
                    $('#minute'+index).val(val.minute).prop('selected',true);
                    $('input[name=korean'+index+']').val(val.korean);
                    $('input[name=english'+index+']').val(val.english);
                    index++;
                }
                document.getElementsByName('hour')

            }
            function setJson(){
                var textArray = [];
                for(var i = 0 ; i < 8 ; i ++){
                    let tmpObj = {};
                    tmpObj.hId = 'h'+i;
                    tmpObj.mId = 'm'+i;
                    tmpObj.sId = 's'+i;
                    tmpObj.korean = $('input[name=korean'+i+']').val();
                    tmpObj.english = $('input[name=english'+i+']').val();
                    tmpObj.hour = $('#hour'+i+' option:selected').val();
                    tmpObj.minute = $('#minute'+i+' option:selected').val();
                    textArray.push(tmpObj);
                }
                localStorage.removeItem('data');
                let obj = {textArray : textArray}; 
                let json = JSON.stringify(obj);
                localStorage.setItem('data', json);
            }

            function numFormat(variable) { 
                variable = Number(variable).toString(); 
                if(Number(variable) < 10 && variable.length == 1) variable = "0" + variable; 
                return variable; 
            }
        </script>
    </body>
</html>